!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){(function(e){var n;n=function(){"use strict";var t=void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i=function(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n},o=function(t){if("string"!=typeof t)throw new Error("str2binl was passed a non-string");for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e},s=function(t,e,n,r,o,s){return i((a=i(i(e,t),i(r,s)))<<(c=o)|a>>>32-c,n);var a,c},a=function(t,e,n,r,i,o,a){return s(e&n|~e&r,t,e,i,o,a)},c=function(t,e,n,r,i,o,a){return s(e&r|n&~r,t,e,i,o,a)},u=function(t,e,n,r,i,o,a){return s(e^n^r,t,e,i,o,a)},l=function(t,e,n,r,i,o,a){return s(n^(e|~r),t,e,i,o,a)},h=function(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var n,r,o,s,h=1732584193,d=-271733879,f=-1732584194,p=271733878,m=0;m<t.length;m+=16)n=h,r=d,o=f,s=p,h=a(h,d,f,p,t[m+0],7,-680876936),p=a(p,h,d,f,t[m+1],12,-389564586),f=a(f,p,h,d,t[m+2],17,606105819),d=a(d,f,p,h,t[m+3],22,-1044525330),h=a(h,d,f,p,t[m+4],7,-176418897),p=a(p,h,d,f,t[m+5],12,1200080426),f=a(f,p,h,d,t[m+6],17,-1473231341),d=a(d,f,p,h,t[m+7],22,-45705983),h=a(h,d,f,p,t[m+8],7,1770035416),p=a(p,h,d,f,t[m+9],12,-1958414417),f=a(f,p,h,d,t[m+10],17,-42063),d=a(d,f,p,h,t[m+11],22,-1990404162),h=a(h,d,f,p,t[m+12],7,1804603682),p=a(p,h,d,f,t[m+13],12,-40341101),f=a(f,p,h,d,t[m+14],17,-1502002290),d=a(d,f,p,h,t[m+15],22,1236535329),h=c(h,d,f,p,t[m+1],5,-165796510),p=c(p,h,d,f,t[m+6],9,-1069501632),f=c(f,p,h,d,t[m+11],14,643717713),d=c(d,f,p,h,t[m+0],20,-373897302),h=c(h,d,f,p,t[m+5],5,-701558691),p=c(p,h,d,f,t[m+10],9,38016083),f=c(f,p,h,d,t[m+15],14,-660478335),d=c(d,f,p,h,t[m+4],20,-405537848),h=c(h,d,f,p,t[m+9],5,568446438),p=c(p,h,d,f,t[m+14],9,-1019803690),f=c(f,p,h,d,t[m+3],14,-187363961),d=c(d,f,p,h,t[m+8],20,1163531501),h=c(h,d,f,p,t[m+13],5,-1444681467),p=c(p,h,d,f,t[m+2],9,-51403784),f=c(f,p,h,d,t[m+7],14,1735328473),d=c(d,f,p,h,t[m+12],20,-1926607734),h=u(h,d,f,p,t[m+5],4,-378558),p=u(p,h,d,f,t[m+8],11,-2022574463),f=u(f,p,h,d,t[m+11],16,1839030562),d=u(d,f,p,h,t[m+14],23,-35309556),h=u(h,d,f,p,t[m+1],4,-1530992060),p=u(p,h,d,f,t[m+4],11,1272893353),f=u(f,p,h,d,t[m+7],16,-155497632),d=u(d,f,p,h,t[m+10],23,-1094730640),h=u(h,d,f,p,t[m+13],4,681279174),p=u(p,h,d,f,t[m+0],11,-358537222),f=u(f,p,h,d,t[m+3],16,-722521979),d=u(d,f,p,h,t[m+6],23,76029189),h=u(h,d,f,p,t[m+9],4,-640364487),p=u(p,h,d,f,t[m+12],11,-421815835),f=u(f,p,h,d,t[m+15],16,530742520),d=u(d,f,p,h,t[m+2],23,-995338651),h=l(h,d,f,p,t[m+0],6,-198630844),p=l(p,h,d,f,t[m+7],10,1126891415),f=l(f,p,h,d,t[m+14],15,-1416354905),d=l(d,f,p,h,t[m+5],21,-57434055),h=l(h,d,f,p,t[m+12],6,1700485571),p=l(p,h,d,f,t[m+3],10,-1894986606),f=l(f,p,h,d,t[m+10],15,-1051523),d=l(d,f,p,h,t[m+1],21,-2054922799),h=l(h,d,f,p,t[m+8],6,1873313359),p=l(p,h,d,f,t[m+15],10,-30611744),f=l(f,p,h,d,t[m+6],15,-1560198380),d=l(d,f,p,h,t[m+13],21,1309151649),h=l(h,d,f,p,t[m+4],6,-145523070),p=l(p,h,d,f,t[m+11],10,-1120210379),f=l(f,p,h,d,t[m+2],15,718787259),d=l(d,f,p,h,t[m+9],21,-343485551),h=i(h,n),d=i(d,r),f=i(f,o),p=i(p,s);return[h,d,f,p]},d={hexdigest:function(t){return function(t){for(var e="",n=0;n<4*t.length;n++)e+="0123456789abcdef".charAt(t[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(t[n>>2]>>n%4*8&15);return e}(h(o(t),8*t.length))},hash:function(t){return function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e}(h(o(t),8*t.length))}};function f(t,e){t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;var n,r,i,o,s,a,c,u,l=new Array(80),h=1732584193,d=-271733879,f=-1732584194,g=271733878,y=-1009589776;for(n=0;n<t.length;n+=16){for(o=h,s=d,a=f,c=g,u=y,r=0;r<80;r++)l[r]=r<16?t[n+r]:v(l[r-3]^l[r-8]^l[r-14]^l[r-16],1),i=_(_(v(h,5),p(r,d,f,g)),_(_(y,l[r]),m(r))),y=g,g=f,f=v(d,30),d=h,h=i;h=_(h,o),d=_(d,s),f=_(f,a),g=_(g,c),y=_(y,u)}return[h,d,f,g,y]}function p(t,e,n,r){return t<20?e&n|~e&r:t<40?e^n^r:t<60?e&n|e&r|n&r:e^n^r}function m(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function g(t,e){var n=y(t);n.length>16&&(n=f(n,8*t.length));for(var r=new Array(16),i=new Array(16),o=0;o<16;o++)r[o]=909522486^n[o],i[o]=1549556828^n[o];var s=f(r.concat(y(e)),512+8*e.length);return f(i.concat(s),672)}function _(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function v(t,e){return t<<e|t>>>32-e}function y(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}function b(t){for(var e,n,r="",i=0;i<4*t.length;i+=3)for(e=(t[i>>2]>>8*(3-i%4)&255)<<16|(t[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|t[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*t.length?r+="=":r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>6*(3-n)&63);return r}function S(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>24-n%32&255);return e}var x={b64_hmac_sha1:function(t,e){return b(g(t,e))},b64_sha1:function(t){return b(f(y(t),8*t.length))},binb2str:S,core_hmac_sha1:g,str_hmac_sha1:function(t,e){return S(g(t,e))},str_sha1:function(t){return S(f(y(t),8*t.length))}},w=function(t){var e,n,r="",i=t.length;for(e=0;e<i;e++)(n=t.charCodeAt(e))>=0&&n<=127?r+=t.charAt(e):n>2047?(r+=String.fromCharCode(224|n>>12&15),r+=String.fromCharCode(128|n>>6&63),r+=String.fromCharCode(128|n>>0&63)):(r+=String.fromCharCode(192|n>>6&31),r+=String.fromCharCode(128|n>>0&63));return r},T=function(t){for(var e in t=t||{})if(Object.prototype.hasOwnProperty.call(t,e)){var r="",i="",o="",s=t[e],a="object"===n(s),c=escape(unescape(a?s.value:s));a&&(r=s.expires?";expires="+s.expires:"",i=s.domain?";domain="+s.domain:"",o=s.path?";path="+s.path:""),document.cookie=e+"="+c+r+i+o}};function N(t,e){return new O.Builder(t,e)}function A(t){return new O.Builder("iq",t)}function E(t){return new O.Builder("presence",t)}var O={VERSION:"@VERSION@",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(t){for(var e=0;e<O.XHTML.tags.length;e++)if(t===O.XHTML.tags[e])return!0;return!1},validAttribute:function(t,e){if(void 0!==O.XHTML.attributes[t]&&O.XHTML.attributes[t].length>0)for(var n=0;n<O.XHTML.attributes[t].length;n++)if(e===O.XHTML.attributes[t][n])return!0;return!1},validCSS:function(t){for(var e=0;e<O.XHTML.css.length;e++)if(t===O.XHTML.css[e])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(t,e){O.NS[t]=e},forEachChild:function(t,e,n){for(var r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];i.nodeType!==O.ElementType.NORMAL||e&&!this.isTagEqual(i,e)||n(i)}},isTagEqual:function(t,e){return t.tagName===e},_xmlGenerator:null,_makeGenerator:function(){var t;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(t=this._getIEXmlDom()).appendChild(t.createElement("strophe")):t=document.implementation.createDocument("jabber:client","strophe",null),t},xmlGenerator:function(){return O._xmlGenerator||(O._xmlGenerator=O._makeGenerator()),O._xmlGenerator},_getIEXmlDom:function(){for(var t=null,e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<e.length&&null===t;n++)try{t=new ActiveXObject(e[n])}catch(e){t=null}return t},xmlElement:function(t){if(!t)return null;for(var e=O.xmlGenerator().createElement(t),r=1;r<arguments.length;r++){var i=arguments[r];if(i)if("string"==typeof i||"number"==typeof i)e.appendChild(O.xmlTextNode(i));else if("object"===n(i)&&"function"==typeof i.sort)for(var o=0;o<i.length;o++){var s=i[o];"object"===n(s)&&"function"==typeof s.sort&&void 0!==s[1]&&null!==s[1]&&e.setAttribute(s[0],s[1])}else if("object"===n(i))for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&void 0!==i[a]&&null!==i[a]&&e.setAttribute(a,i[a])}return e},xmlescape:function(t){return t=(t=(t=(t=(t=t.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(t){return t=(t=(t=(t=(t=t.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(t){return O.xmlGenerator().createTextNode(t)},xmlHtmlNode:function(t){var e;return DOMParser?e=(new DOMParser).parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)),e},getText:function(t){if(!t)return null;var e="";0===t.childNodes.length&&t.nodeType===O.ElementType.TEXT&&(e+=t.nodeValue);for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].nodeType===O.ElementType.TEXT&&(e+=t.childNodes[n].nodeValue);return O.xmlescape(e)},copyElement:function(t){var e;if(t.nodeType===O.ElementType.NORMAL){e=O.xmlElement(t.tagName);for(var n=0;n<t.attributes.length;n++)e.setAttribute(t.attributes[n].nodeName,t.attributes[n].value);for(var r=0;r<t.childNodes.length;r++)e.appendChild(O.copyElement(t.childNodes[r]))}else t.nodeType===O.ElementType.TEXT&&(e=O.xmlGenerator().createTextNode(t.nodeValue));return e},createHtml:function(t){var e;if(t.nodeType===O.ElementType.NORMAL){var r=t.nodeName.toLowerCase();if(O.XHTML.validTag(r))try{e=O.xmlElement(r);for(var i=0;i<O.XHTML.attributes[r].length;i++){var o=O.XHTML.attributes[r][i],s=t.getAttribute(o);if(null!=s&&""!==s&&!1!==s&&0!==s)if("style"===o&&"object"===n(s)&&void 0!==s.cssText&&(s=s.cssText),"style"===o){for(var a=[],c=s.split(";"),u=0;u<c.length;u++){var l=c[u].split(":"),h=l[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(O.XHTML.validCSS(h)){var d=l[1].replace(/^\s*/,"").replace(/\s*$/,"");a.push(h+": "+d)}}a.length>0&&(s=a.join("; "),e.setAttribute(o,s))}else e.setAttribute(o,s)}for(var f=0;f<t.childNodes.length;f++)e.appendChild(O.createHtml(t.childNodes[f]))}catch(t){e=O.xmlTextNode("")}else{e=O.xmlGenerator().createDocumentFragment();for(var p=0;p<t.childNodes.length;p++)e.appendChild(O.createHtml(t.childNodes[p]))}}else if(t.nodeType===O.ElementType.FRAGMENT){e=O.xmlGenerator().createDocumentFragment();for(var m=0;m<t.childNodes.length;m++)e.appendChild(O.createHtml(t.childNodes[m]))}else t.nodeType===O.ElementType.TEXT&&(e=O.xmlTextNode(t.nodeValue));return e},escapeNode:function(t){return"string"!=typeof t?t:t.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(t){return"string"!=typeof t?t:t.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(t){return t.indexOf("@")<0?null:t.split("@")[0]},getDomainFromJid:function(t){var e=O.getBareJidFromJid(t);if(e.indexOf("@")<0)return e;var n=e.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(t){if(!t)return null;var e=t.split("/");return e.length<2?null:(e.splice(0,1),e.join("/"))},getBareJidFromJid:function(t){return t?t.split("/")[0]:null},_handleError:function(t){void 0!==t.stack&&O.fatal(t.stack),t.sourceURL?O.fatal("error: "+this.handler+" "+t.sourceURL+":"+t.line+" - "+t.name+": "+t.message):t.fileName?O.fatal("error: "+this.handler+" "+t.fileName+":"+t.lineNumber+" - "+t.name+": "+t.message):O.fatal("error: "+t.message)},log:function(t,e){t===this.LogLevel.FATAL&&"object"===n(window.console)&&"function"==typeof window.console.error&&window.console.error(e)},debug:function(t){this.log(this.LogLevel.DEBUG,t)},info:function(t){this.log(this.LogLevel.INFO,t)},warn:function(t){this.log(this.LogLevel.WARN,t)},error:function(t){this.log(this.LogLevel.ERROR,t)},fatal:function(t){this.log(this.LogLevel.FATAL,t)},serialize:function(t){if(!t)return null;"function"==typeof t.tree&&(t=t.tree());var e=r(Array(t.attributes.length).keys()).map((function(e){return t.attributes[e].nodeName}));e.sort();var n=e.reduce((function(e,n){return"".concat(e," ").concat(n,'="').concat(O.xmlescape(t.attributes.getNamedItem(n).value),'"')}),"<".concat(t.nodeName));if(t.childNodes.length>0){n+=">";for(var i=0;i<t.childNodes.length;i++){var o=t.childNodes[i];switch(o.nodeType){case O.ElementType.NORMAL:n+=O.serialize(o);break;case O.ElementType.TEXT:n+=O.xmlescape(o.nodeValue);break;case O.ElementType.CDATA:n+="<![CDATA["+o.nodeValue+"]]>"}}n+="</"+t.nodeName+">"}else n+="/>";return n},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(t,e){O._connectionPlugins[t]=e},Builder:function(t,e){"presence"!==t&&"message"!==t&&"iq"!==t||(e&&!e.xmlns?e.xmlns=O.NS.CLIENT:e||(e={xmlns:O.NS.CLIENT})),this.nodeTree=O.xmlElement(t,e),this.node=this.nodeTree}};O.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return O.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(void 0===t[e]?this.node.removeAttribute(e):this.node.setAttribute(e,t[e]));return this},c:function(t,e,n){var r=O.xmlElement(t,e,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this},cnode:function(t){var e,n=O.xmlGenerator();try{e=void 0!==n.importNode}catch(t){e=!1}var r=e?n.importNode(t,!0):O.copyElement(t);return this.node.appendChild(r),this.node=r,this},t:function(t){var e=O.xmlTextNode(t);return this.node.appendChild(e),this},h:function(t){var e=document.createElement("body");e.innerHTML=t;for(var n=O.createHtml(e);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},O.Handler=function(t,e,n,r,i,o,s){this.handler=t,this.ns=e,this.name=n,this.type=r,this.id=i,this.options=s||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(O.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=o?O.getBareJidFromJid(o):null:this.from=o,this.user=!0},O.Handler.prototype={getNamespace:function(t){var e=t.getAttribute("xmlns");return e&&this.options.ignoreNamespaceFragment&&(e=e.split("#")[0]),e},namespaceMatch:function(t){var e=this,n=!1;return!this.ns||(O.forEachChild(t,null,(function(t){e.getNamespace(t)===e.ns&&(n=!0)})),n||this.getNamespace(t)===this.ns)},isMatch:function(t){var e=t.getAttribute("from");this.options.matchBareFromJid&&(e=O.getBareJidFromJid(e));var n=t.getAttribute("type");return!(!this.namespaceMatch(t)||this.name&&!O.isTagEqual(t,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&t.getAttribute("id")!==this.id||this.from&&e!==this.from)},run:function(t){var e=null;try{e=this.handler(t)}catch(t){throw O._handleError(t),t}return e},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},O.TimedHandler=function(t,e){this.period=t,this.handler=e,this.lastCalled=(new Date).getTime(),this.user=!0},O.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},O.Connection=function(t,e){var n=this;this.service=t,this.options=e||{};var r=this.options.protocol||"";for(var i in 0===t.indexOf("ws:")||0===t.indexOf("wss:")||0===r.indexOf("ws")?this._proto=new O.Websocket(this):this._proto=new O.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((function(){return n._onIdle()}),100),T(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),O._connectionPlugins)if(Object.prototype.hasOwnProperty.call(O._connectionPlugins,i)){var o=function(){};o.prototype=O._connectionPlugins[i],this[i]=new o,this[i].init(this)}},O.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(t){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}));return"string"==typeof t||"number"==typeof t?e+":"+t:e+""},addProtocolErrorHandler:function(t,e,n){this.protocolErrorHandlers[t][e]=n},connect:function(t,e,n,r,i,o,s){this.jid=t,this.authzid=O.getBareJidFromJid(this.jid),this.authcid=s||O.getNodeFromJid(this.jid),this.pass=e,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=O.getDomainFromJid(this.jid),this._changeConnectStatus(O.Status.CONNECTING,null),this._proto._connect(r,i,o)},attach:function(t,e,n,r,i,o,s){if(!(this._proto instanceof O.Bosh)){var a=new Error('The "attach" method can only be used with a BOSH connection.');throw a.name="StropheSessionError",a}this._proto._attach(t,e,n,r,i,o,s)},restore:function(t,e,n,r,i){if(!this._sessionCachingSupported()){var o=new Error('The "restore" method can only be used with a BOSH connection.');throw o.name="StropheSessionError",o}this._proto._restore(t,e,n,r,i)},_sessionCachingSupported:function(){if(this._proto instanceof O.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(t){return!1}return!0}return!1},xmlInput:function(t){},xmlOutput:function(t){},rawInput:function(t){},rawOutput:function(t){},nextValidRid:function(t){},send:function(t){if(null!==t){if("function"==typeof t.sort)for(var e=0;e<t.length;e++)this._queueData(t[e]);else"function"==typeof t.tree?this._queueData(t.tree()):this._queueData(t);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(t,e,n,r){var i=this,o=null;"function"==typeof t.tree&&(t=t.tree());var s=t.getAttribute("id");if(s||(s=this.getUniqueId("sendPresence"),t.setAttribute("id",s)),"function"==typeof e||"function"==typeof n){var a=this.addHandler((function(t){o&&i.deleteTimedHandler(o),"error"===t.getAttribute("type")?n&&n(t):e&&e(t)}),null,"presence",null,s);r&&(o=this.addTimedHandler(r,(function(){return i.deleteHandler(a),n&&n(null),!1})))}return this.send(t),s},sendIQ:function(t,e,n,r){var i=this,o=null;"function"==typeof t.tree&&(t=t.tree());var s=t.getAttribute("id");if(s||(s=this.getUniqueId("sendIQ"),t.setAttribute("id",s)),"function"==typeof e||"function"==typeof n){var a=this.addHandler((function(t){o&&i.deleteTimedHandler(o);var r=t.getAttribute("type");if("result"===r)e&&e(t);else{if("error"!==r){var s=new Error("Got bad IQ type of ".concat(r));throw s.name="StropheError",s}n&&n(t)}}),null,"iq",["error","result"],s);r&&(o=this.addTimedHandler(r,(function(){return i.deleteHandler(a),n&&n(null),!1})))}return this.send(t),s},_queueData:function(t){if(null===t||!t.tagName||!t.childNodes){var e=new Error("Cannot queue non-DOMElement.");throw e.name="StropheError",e}this._data.push(t)},_sendRestart:function(){var t=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((function(){return t._onIdle()}),100)},addTimedHandler:function(t,e){var n=new O.TimedHandler(t,e);return this.addTimeds.push(n),n},deleteTimedHandler:function(t){this.removeTimeds.push(t)},addHandler:function(t,e,n,r,i,o,s){var a=new O.Handler(t,e,n,r,i,o,s);return this.addHandlers.push(a),a},deleteHandler:function(t){this.removeHandlers.push(t);var e=this.addHandlers.indexOf(t);e>=0&&this.addHandlers.splice(e,1)},registerSASLMechanisms:function(t){this.mechanisms={},(t=t||[O.SASLAnonymous,O.SASLExternal,O.SASLMD5,O.SASLOAuthBearer,O.SASLXOAuth2,O.SASLPlain,O.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(t){this.mechanisms[t.prototype.name]=t},disconnect:function(t){if(this._changeConnectStatus(O.Status.DISCONNECTING,t),O.warn("Disconnect was called because: "+t),this.connected){var e=!1;this.disconnecting=!0,this.authenticated&&(e=E({xmlns:O.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else O.warn("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(t,e,n){for(var r in O._connectionPlugins)if(Object.prototype.hasOwnProperty.call(O._connectionPlugins,r)){var i=this[r];if(i.statusChanged)try{i.statusChanged(t,e)}catch(t){O.error("".concat(r," plugin caused an exception changing status: ").concat(t))}}if(this.connect_callback)try{this.connect_callback(t,e,n)}catch(t){O._handleError(t),O.error("User connection callback caused an exception: ".concat(t))}},_doDisconnect:function(t){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),O.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(O.Status.DISCONNECTED,t),this.connected=!1},_dataRecv:function(t,e){var n=this;O.debug("_dataRecv called");var r=this._proto._reqToData(t);if(null!==r){for(this.xmlInput!==O.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==O.Connection.prototype.rawInput&&(e?this.rawInput(e):this.rawInput(O.serialize(r)));this.removeHandlers.length>0;){var i=this.removeHandlers.pop(),o=this.handlers.indexOf(i);o>=0&&this.handlers.splice(o,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var s=r.getAttribute("type");if(null!==s&&"terminate"===s){if(this.disconnecting)return;var a=r.getAttribute("condition"),c=r.getElementsByTagName("conflict");return null!==a?("remote-stream-error"===a&&c.length>0&&(a="conflict"),this._changeConnectStatus(O.Status.CONNFAIL,a)):this._changeConnectStatus(O.Status.CONNFAIL,O.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}O.forEachChild(r,null,(function(t){var e=n.handlers;n.handlers=[];for(var r=0;r<e.length;r++){var i=e[r];try{!i.isMatch(t)||!n.authenticated&&i.user?n.handlers.push(i):i.run(t)&&n.handlers.push(i)}catch(t){O.warn("Removing Strophe handlers due to uncaught exception: "+t.message)}}}))}}},mechanisms:{},_connect_cb:function(t,e,n){var r;O.debug("_connect_cb was called"),this.connected=!0;try{r=this._proto._reqToData(t)}catch(t){if(t.name!==O.ErrorCondition.BAD_FORMAT)throw t;this._changeConnectStatus(O.Status.CONNFAIL,O.ErrorCondition.BAD_FORMAT),this._doDisconnect(O.ErrorCondition.BAD_FORMAT)}if(r&&(this.xmlInput!==O.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==O.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(O.serialize(r))),this._proto._connect_cb(r)!==O.Status.CONNFAIL))if(r.getElementsByTagNameNS?r.getElementsByTagNameNS(O.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0){var i=[],o=r.getElementsByTagName("mechanism");if(o.length>0)for(var s=0;s<o.length;s++){var a=O.getText(o[s]);this.mechanisms[a]&&i.push(this.mechanisms[a])}0!==i.length||0!==r.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(i):this._proto._no_auth_received(e)}else this._proto._no_auth_received(e)},sortMechanismsByPriority:function(t){for(var e=0;e<t.length-1;++e){for(var n=e,r=e+1;r<t.length;++r)t[r].prototype.priority>t[n].prototype.priority&&(n=r);if(n!==e){var i=t[e];t[e]=t[n],t[n]=i}}return t},authenticate:function(t){this._attemptSASLAuth(t)||this._attemptLegacyAuth()},_attemptSASLAuth:function(t){t=this.sortMechanismsByPriority(t||[]);for(var e=!1,n=0;n<t.length;++n)if(t[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new t[n],this._sasl_mechanism.onStart(this);var r=N("auth",{xmlns:O.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var i=this._sasl_mechanism.onChallenge(this,null);r.t(btoa(i))}this.send(r.tree()),e=!0;break}return e},_sasl_challenge_cb:function(t){var e=atob(O.getText(t)),n=this._sasl_mechanism.onChallenge(this,e),r=N("response",{xmlns:O.NS.SASL});return""!==n&&r.t(btoa(n)),this.send(r.tree()),!0},_attemptLegacyAuth:function(){null===O.getNodeFromJid(this.jid)?(this._changeConnectStatus(O.Status.CONNFAIL,O.ErrorCondition.MISSING_JID_NODE),this.disconnect(O.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(O.Status.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(A({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:O.NS.AUTH}).c("username",{}).t(O.getNodeFromJid(this.jid)).tree()))},_onLegacyAuthIQResult:function(t){var e=A({type:"set",id:"_auth_2"}).c("query",{xmlns:O.NS.AUTH}).c("username",{}).t(O.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return O.getResourceFromJid(this.jid)||(this.jid=O.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(O.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(t){var e=this;if(this._sasl_data["server-signature"]){var n,r=atob(O.getText(t)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===r[1]&&(n=r[2]),n!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}O.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var i=[],o=function(t,n){for(;t.length;)e.deleteHandler(t.pop());return e._onStreamFeaturesAfterSASL(n),!1};return i.push(this._addSysHandler((function(t){return o(i,t)}),null,"stream:features",null,null)),i.push(this._addSysHandler((function(t){return o(i,t)}),O.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_onStreamFeaturesAfterSASL:function(t){this.features=t;for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(O.Status.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(O.Status.AUTHFAIL,null),!1)},bind:function(){if(this.do_bind){this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");var t=O.getResourceFromJid(this.jid);t?this.send(A({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:O.NS.BIND}).c("resource",{}).t(t).tree()):this.send(A({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:O.NS.BIND}).tree())}else O.log(O.LogLevel.INFO,'Strophe.Connection.prototype.bind called but "do_bind" is false')},_onResourceBindResultIQ:function(t){var e;if("error"===t.getAttribute("type"))return O.warn("Resource binding failed."),t.getElementsByTagName("conflict").length>0&&(e=O.ErrorCondition.CONFLICT),this._changeConnectStatus(O.Status.AUTHFAIL,e,t),!1;var n=t.getElementsByTagName("bind");if(!(n.length>0))return O.warn("Resource binding failed."),this._changeConnectStatus(O.Status.AUTHFAIL,null,t),!1;var r=n[0].getElementsByTagName("jid");r.length>0&&(this.jid=O.getText(r[0]),this.do_session?this._establishSession():(this.authenticated=!0,this._changeConnectStatus(O.Status.CONNECTED,null)))},_establishSession:function(){if(!this.do_session)throw new Error("Strophe.Connection.prototype._establishSession "+"called but apparently ".concat(O.NS.SESSION," wasn't advertised by the server"));this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(A({type:"set",id:"_session_auth_2"}).c("session",{xmlns:O.NS.SESSION}).tree())},_onSessionResultIQ:function(t){if("result"===t.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(O.Status.CONNECTED,null);else if("error"===t.getAttribute("type"))return O.warn("Session creation failed."),this._changeConnectStatus(O.Status.AUTHFAIL,null,t),!1;return!1},_sasl_failure_cb:function(t){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(O.Status.AUTHFAIL,null,t),!1},_auth2_cb:function(t){return"result"===t.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(O.Status.CONNECTED,null)):"error"===t.getAttribute("type")&&(this._changeConnectStatus(O.Status.AUTHFAIL,null,t),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(t,e){var n=new O.TimedHandler(t,e);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(t,e,n,r,i){var o=new O.Handler(t,e,n,r,i);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return O.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(O.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var t=this;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){var e=this.removeTimeds.pop(),n=this.timedHandlers.indexOf(e);n>=0&&this.timedHandlers.splice(n,1)}for(var r=(new Date).getTime(),i=[],o=0;o<this.timedHandlers.length;o++){var s=this.timedHandlers[o];!this.authenticated&&s.user||(s.lastCalled+s.period-r<=0?s.run()&&i.push(s):i.push(s))}this.timedHandlers=i,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((function(){return t._onIdle()}),100))}},O.SASLMechanism=function(t,e,n){this.name=t,this.isClientFirst=e,this.priority=n},O.SASLMechanism.prototype={test:function(t){return!0},onStart:function(t){this._connection=t},onChallenge:function(t,e){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},O.SASLAnonymous=function(){},O.SASLAnonymous.prototype=new O.SASLMechanism("ANONYMOUS",!1,20),O.SASLAnonymous.prototype.test=function(t){return null===t.authcid},O.SASLPlain=function(){},O.SASLPlain.prototype=new O.SASLMechanism("PLAIN",!0,50),O.SASLPlain.prototype.test=function(t){return null!==t.authcid},O.SASLPlain.prototype.onChallenge=function(t){var e=t.authzid;return e+="\0",e+=t.authcid,e+="\0",e+=t.pass,w(e)},O.SASLSHA1=function(){},O.SASLSHA1.prototype=new O.SASLMechanism("SCRAM-SHA-1",!0,70),O.SASLSHA1.prototype.test=function(t){return null!==t.authcid},O.SASLSHA1.prototype.onChallenge=function(t,e,n){var r=n||d.hexdigest(""+1234567890*Math.random()),i="n="+w(t.authcid);return i+=",r=",i+=r,t._sasl_data.cnonce=r,t._sasl_data["client-first-message-bare"]=i,i="n,,"+i,this.onChallenge=function(t,e){for(var n,r,i,o,s,a,c,u,l="c=biws,",h="".concat(t._sasl_data["client-first-message-bare"],",").concat(e,","),d=t._sasl_data.cnonce,f=/([a-z]+)=([^,]+)(,|$)/;e.match(f);){var p=e.match(f);switch(e=e.replace(p[0],""),p[1]){case"r":n=p[2];break;case"s":r=p[2];break;case"i":i=p[2]}}if(n.substr(0,d.length)!==d)return t._sasl_data={},t._sasl_failure_cb();h+=l+="r="+n,r=atob(r),r+="\0\0\0";var m=w(t.pass);for(o=a=x.core_hmac_sha1(m,r),c=1;c<i;c++){for(s=x.core_hmac_sha1(m,x.binb2str(a)),u=0;u<5;u++)o[u]^=s[u];a=s}o=x.binb2str(o);var g=x.core_hmac_sha1(o,"Client Key"),_=x.str_hmac_sha1(o,"Server Key"),v=x.core_hmac_sha1(x.str_sha1(x.binb2str(g)),h);for(t._sasl_data["server-signature"]=x.b64_hmac_sha1(_,h),u=0;u<5;u++)g[u]^=v[u];return l+=",p="+btoa(x.binb2str(g))},i},O.SASLMD5=function(){},O.SASLMD5.prototype=new O.SASLMechanism("DIGEST-MD5",!1,60),O.SASLMD5.prototype.test=function(t){return null!==t.authcid},O.SASLMD5.prototype._quote=function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},O.SASLMD5.prototype.onChallenge=function(t,e,n){for(var r=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,i=n||d.hexdigest(""+1234567890*Math.random()),o="",s=null,a="";e.match(r);){var c=e.match(r);switch(e=e.replace(c[0],""),c[2]=c[2].replace(/^"(.+)"$/,"$1"),c[1]){case"realm":o=c[2];break;case"nonce":a=c[2];break;case"qop":c[2];break;case"host":s=c[2]}}var u=t.servtype+"/"+t.domain;null!==s&&(u=u+"/"+s);var l=w(t.authcid+":"+o+":"+this._connection.pass),h=d.hash(l)+":"+a+":"+i,f="AUTHENTICATE:"+u,p="";return p+="charset=utf-8,",p+="username="+this._quote(w(t.authcid))+",",p+="realm="+this._quote(o)+",",p+="nonce="+this._quote(a)+",",p+="nc=00000001,",p+="cnonce="+this._quote(i)+",",p+="digest-uri="+this._quote(u)+",",p+="response="+d.hexdigest(d.hexdigest(h)+":"+a+":00000001:"+i+":auth:"+d.hexdigest(f))+",",p+="qop=auth",this.onChallenge=function(){return""},p},O.SASLOAuthBearer=function(){},O.SASLOAuthBearer.prototype=new O.SASLMechanism("OAUTHBEARER",!0,40),O.SASLOAuthBearer.prototype.test=function(t){return null!==t.pass},O.SASLOAuthBearer.prototype.onChallenge=function(t){var e="n,";return null!==t.authcid&&(e=e+"a="+t.authzid),e+=",",e+="",e+="auth=Bearer ",e+=t.pass,e+="",w(e+="")},O.SASLExternal=function(){},O.SASLExternal.prototype=new O.SASLMechanism("EXTERNAL",!0,10),O.SASLExternal.prototype.onChallenge=function(t){return t.authcid===t.authzid?"":t.authzid},O.SASLXOAuth2=function(){},O.SASLXOAuth2.prototype=new O.SASLMechanism("X-OAUTH2",!0,30),O.SASLXOAuth2.prototype.test=function(t){return null!==t.pass},O.SASLXOAuth2.prototype.onChallenge=function(t){var e="\0";return null!==t.authcid&&(e+=t.authzid),e+="\0",e+=t.pass,w(e)};var C={Strophe:O,$build:N,$iq:A,$msg:function(t){return new O.Builder("message",t)},$pres:E,SHA1:x,MD5:d,b64_hmac_sha1:x.b64_hmac_sha1,b64_sha1:x.b64_sha1,str_hmac_sha1:x.str_hmac_sha1,str_sha1:x.str_sha1},L=C.Strophe,I=C.$build;L.Request=function(t,e,n,r){this.id=++L._requestId,this.xmlData=t,this.data=L.serialize(t),this.origFunc=e,this.func=e,this.rid=n,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},L.Request.prototype={getResponse:function(){var t=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(t=this.xhr.responseXML.documentElement).tagName)throw L.error("invalid response received"),L.error("responseText: "+this.xhr.responseText),L.error("responseXML: "+L.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(L.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(t=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(t.querySelector("parsererror")){L.error("invalid response received: "+t.querySelector("parsererror").textContent),L.error("responseText: "+this.xhr.responseText);var e=new Error;throw e.name=L.ErrorCondition.BAD_FORMAT,e}}return t},_newXHR:function(){var t=null;return window.XMLHttpRequest?(t=new XMLHttpRequest).overrideMimeType&&t.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.onreadystatechange=this.func.bind(null,this),t}},L.Bosh=function(t){this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},L.Bosh.prototype={strip:null,_buildBody:function(){var t=I("body",{rid:this.rid++,xmlns:L.NS.HTTPBIND});return null!==this.sid&&t.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),t},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(t,e,n){this.wait=t||this.wait,this.hold=e||this.hold,this.errors=0;var r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":L.NS.BOSH});n&&r.attrs({route:n});var i=this._conn._connect_cb;this._requests.push(new L.Request(r.tree(),this._onRequestStateChange.bind(this,i.bind(this._conn)),r.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(t,e,n,r,i,o,s){this._conn.jid=t,this.sid=e,this.rid=n,this._conn.connect_callback=r,this._conn.domain=L.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=i||this.wait,this.hold=o||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(L.Status.ATTACHED,null)},_restore:function(t,e,n,r,i){var o=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=o&&o.rid&&o.sid&&o.jid&&(null==t||L.getBareJidFromJid(o.jid)===L.getBareJidFromJid(t)||null===L.getNodeFromJid(t)&&L.getDomainFromJid(o.jid)===t))){var s=new Error("_restore: no restoreable session.");throw s.name="StropheSessionError",s}this._conn.restored=!0,this._attach(o.jid,o.sid,o.rid,e,n,r,i)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(t){var e=t.getAttribute("type");if(null!==e&&"terminate"===e){var n=t.getAttribute("condition");L.error("BOSH-Connection failed: "+n);var r=t.getElementsByTagName("conflict");return null!==n?("remote-stream-error"===n&&r.length>0&&(n="conflict"),this._conn._changeConnectStatus(L.Status.CONNFAIL,n)):this._conn._changeConnectStatus(L.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),L.Status.CONNFAIL}this.sid||(this.sid=t.getAttribute("sid"));var i=t.getAttribute("requests");i&&(this.window=parseInt(i,10));var o=t.getAttribute("hold");o&&(this.hold=parseInt(o,10));var s=t.getAttribute("wait");s&&(this.wait=parseInt(s,10));var a=t.getAttribute("inactivity");a&&(this.inactivity=parseInt(a,10))},_disconnect:function(t){this._sendTerminate(t)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(t){var e=this._getRequestStatus(t),n=this._conn.protocolErrorHandlers.HTTP[e];n&&n.call(this,e)},_hitError:function(t){this.errors++,L.warn("request errored, status: "+t+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(t){L.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),t=t?t.bind(this._conn):this._conn._connect_cb.bind(this._conn);var e=this._buildBody();this._requests.push(new L.Request(e.tree(),this._onRequestStateChange.bind(this,t),e.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;this._requests.length>0;){var t=this._requests.pop();t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){}}},_onIdle:function(){var t=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===t.length&&!this._conn.disconnecting&&(L.debug("no requests during idle cycle, sending blank request"),t.push(null)),!this._conn.paused){if(this._requests.length<2&&t.length>0){for(var e=this._buildBody(),n=0;n<t.length;n++)null!==t[n]&&("restart"===t[n]?e.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":L.NS.BOSH}):e.cnode(t[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new L.Request(e.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),e.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var r=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(L.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),r>Math.floor(L.TIMEOUT*this.wait)&&(L.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(L.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(t,e){var n;if(4===t.xhr.readyState)try{n=t.xhr.status}catch(t){L.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof e?e:0),n},_onRequestStateChange:function(t,e){if(L.debug("request id "+e.id+"."+e.sends+" state changed to "+e.xhr.readyState),e.abort)e.abort=!1;else if(4===e.xhr.readyState){var n=this._getRequestStatus(e);if(this.lastResponseHeaders=e.xhr.getAllResponseHeaders(),this.disconnecting&&n>=400)return this._hitError(n),void this._callProtocolErrorHandlers(e);var r=n>0&&n<500,i=e.sends>this._conn.maxRetries;if((r||i)&&(this._removeRequest(e),L.debug("request id "+e.id+" should now be removed")),200===n){var o=this._requests[0]===e;(this._requests[1]===e||o&&this._requests.length>0&&this._requests[0].age()>Math.floor(L.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(e.rid)+1),L.debug("request id "+e.id+"."+e.sends+" got 200"),t(e),this.errors=0}else 0===n||n>=400&&n<600||n>=12e3?(L.error("request id "+e.id+"."+e.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(e),n>=400&&n<500&&(this._conn._changeConnectStatus(L.Status.DISCONNECTING,null),this._conn._doDisconnect())):L.error("request id "+e.id+"."+e.sends+" error "+n+" happened");r||i?i&&!this._conn.connected&&this._conn._changeConnectStatus(L.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(t){var e=this,n=this._requests[t],r=this._getRequestStatus(n,-1);if(n.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var i=n.age(),o=!isNaN(i)&&i>Math.floor(L.TIMEOUT*this.wait),s=null!==n.dead&&n.timeDead()>Math.floor(L.SECONDARY_TIMEOUT*this.wait),a=4===n.xhr.readyState&&(r<1||r>=500);if((o||s||a)&&(s&&L.error("Request ".concat(this._requests[t].id," timed out (secondary), restarting")),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[t]=new L.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[t]),0===n.xhr.readyState){L.debug("request id "+n.id+"."+n.sends+" posting");try{var c=this._conn.options.contentType||"text/xml; charset=utf-8";n.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==n.xhr.setRequestHeader&&n.xhr.setRequestHeader("Content-Type",c),this._conn.options.withCredentials&&(n.xhr.withCredentials=!0)}catch(t){return L.error("XHR open failed: "+t.toString()),this._conn.connected||this._conn._changeConnectStatus(L.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var u=function(){if(n.date=new Date,e._conn.options.customHeaders){var t=e._conn.options.customHeaders;for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.xhr.setRequestHeader(r,t[r])}n.xhr.send(n.data)};if(n.sends>1){var l=1e3*Math.min(Math.floor(L.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout((function(){u()}),l)}else u();n.sends++,this._conn.xmlOutput!==L.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==L.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else L.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+n.xhr.readyState)}},_removeRequest:function(t){L.debug("removing request");for(var e=this._requests.length-1;e>=0;e--)t===this._requests[e]&&this._requests.splice(e,1);t.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(t){var e=this._requests[t];null===e.dead&&(e.dead=new Date),this._processRequest(t)},_reqToData:function(t){try{return t.getResponse()}catch(t){if("parsererror"!==t.message)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(t){L.debug("_sendTerminate was called");var e=this._buildBody().attrs({type:"terminate"});t&&e.cnode(t.tree());var n=new L.Request(e.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),e.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){var t=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((function(){return t._conn._onIdle()}),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?L.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):L.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}};var j=C.Strophe,H=C.$build;return j.Websocket=function(t){this._conn=t,this.strip="wrapper";var e=t.service;if(0!==e.indexOf("ws:")&&0!==e.indexOf("wss:")){var n="";"ws"===t.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==e.indexOf("/")?n+=window.location.pathname+e:n+=e,t.service=n}},j.Websocket.prototype={_buildStream:function(){return H("open",{xmlns:j.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(t,e){var n;if(0===(n=t.getElementsByTagNameNS?t.getElementsByTagNameNS(j.NS.STREAM,"error"):t.getElementsByTagName("stream:error")).length)return!1;for(var r=n[0],i="",o="",s=0;s<r.childNodes.length;s++){var a=r.childNodes[s];if("urn:ietf:params:xml:ns:xmpp-streams"!==a.getAttribute("xmlns"))break;"text"===a.nodeName?o=a.textContent:i=a.nodeName}var c="WebSocket stream error: ";return c+=i||"unknown",o&&(c+=" - "+o),j.error(c),this._conn._changeConnectStatus(e,i),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(t){if(this._check_streamerror(t,j.Status.CONNFAIL))return j.Status.CONNFAIL},_handleStreamStart:function(t){var e=!1,n=t.getAttribute("xmlns");"string"!=typeof n?e="Missing xmlns in <open />":n!==j.NS.FRAMING&&(e="Wrong xmlns in <open />: "+n);var r=t.getAttribute("version");return"string"!=typeof r?e="Missing version in <open />":"1.0"!==r&&(e="Wrong version in <open />: "+r),!e||(this._conn._changeConnectStatus(j.Status.CONNFAIL,e),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(t){if(0===t.data.indexOf("<open ")||0===t.data.indexOf("<?xml")){var e=t.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===e)return;var n=(new DOMParser).parseFromString(e,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(t.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===t.data.indexOf("<close ")){var r=(new DOMParser).parseFromString(t.data,"text/xml").documentElement;this._conn.xmlInput(r),this._conn.rawInput(t.data);var i=r.getAttribute("see-other-uri");if(i){var o=this._conn.service;(o.indexOf("wss:")>=0&&i.indexOf("wss:")>=0||o.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(j.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=i,this._connect())}else this._conn._changeConnectStatus(j.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var s=this._streamWrap(t.data),a=(new DOMParser).parseFromString(s,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(a,null,t.data)}},_disconnect:function(t){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){t&&this._conn.send(t);var e=H("close",{xmlns:j.NS.FRAMING});this._conn.xmlOutput(e.tree());var n=j.serialize(e);this._conn.rawOutput(n);try{this.socket.send(n)}catch(t){j.warn("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){j.debug("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(t){return"<wrapper>"+t+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(t){j.debug(t.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(t){this._conn.connected&&!this._conn.disconnecting?(j.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):t&&1006===t.code&&!this._conn.connected&&this.socket?(j.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(j.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):j.debug("Websocket closed")},_no_auth_received:function(t){j.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(j.Status.CONNFAIL,j.ErrorCondition.NO_AUTH_MECH),t&&t.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(t){j.error("Websocket error "+t),this._conn._changeConnectStatus(j.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var t=this._conn._data;if(t.length>0&&!this._conn.paused){for(var e=0;e<t.length;e++)if(null!==t[e]){var n=void 0;n="restart"===t[e]?this._buildStream().tree():t[e];var r=j.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}},_onMessage:function(t){var e,n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(t.data===n)return this._conn.rawInput(n),this._conn.xmlInput(t),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===t.data.search("<open ")){if(e=(new DOMParser).parseFromString(t.data,"text/xml").documentElement,!this._handleStreamStart(e))return}else{var r=this._streamWrap(t.data);e=(new DOMParser).parseFromString(r,"text/xml").documentElement}return this._check_streamerror(e,j.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===e.firstChild.nodeName&&"unavailable"===e.firstChild.getAttribute("type")?(this._conn.xmlInput(e),void this._conn.rawInput(j.serialize(e))):void this._conn._dataRecv(e,t.data)},_onOpen:function(){j.debug("Websocket open");var t=this._buildStream();this._conn.xmlOutput(t.tree());var e=j.serialize(t);this._conn.rawOutput(e),this.socket.send(e)},_reqToData:function(t){return t},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},t.Strophe=C.Strophe,t.$build=C.$build,t.$iq=C.$iq,t.$msg=C.$msg,t.$pres=C.$pres,C},t.exports=n()}).call(this,n(6))},function(t,e,n){var r=n(7),i=n(8),o=n(9);t.exports=function(t){return r(t)||i(t)||o()}},function(t,e){t.exports=OSjs},function(t){t.exports=JSON.parse('{"a":"StropheJS"}')},function(t,e,n){t.exports=n(10)},function(t,e,n){},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e,n){"use strict";n.r(e);var r=n(2),i=n.n(r),o=(n(5),n(3)),s=n(0);function a(t,e){for(var n=[],r=[],i=arguments.length;i-- >2;)n.push(arguments[i]);for(;n.length;){var o=n.pop();if(o&&o.pop)for(i=o.length;i--;)n.push(o[i]);else null!=o&&!0!==o&&!1!==o&&r.push(o)}return"function"==typeof t?t(e||{},r):{nodeName:t,attributes:e||{},children:r,key:e&&e.key}}function c(t,e,n,r){var i,o=[].map,s=r&&r.children[0]||null,a=s&&function t(e){return{nodeName:e.nodeName.toLowerCase(),attributes:{},children:o.call(e.childNodes,(function(e){return 3===e.nodeType?e.nodeValue:t(e)}))}}(s),c=[],u=!0,l=m(t),h=function t(e,n,r){for(var i in r)"function"==typeof r[i]?function(t,i){r[t]=function(t){var o=i(t);return"function"==typeof o&&(o=o(_(e,l),r)),o&&o!==(n=_(e,l))&&!o.then&&p(l=g(e,m(n,o),l)),o}}(i,r[i]):t(e.concat(i),n[i]=m(n[i]),r[i]=m(r[i]));return r}([],l,m(e));return p(),h;function d(t){return"function"==typeof t?d(t(l,h)):null!=t?t:""}function f(){i=!i;var t=d(n);for(r&&!i&&(s=function t(e,n,r,i,o){if(i===r);else if(null==r||r.nodeName!==i.nodeName){var s=function t(e,n){var r="string"==typeof e||"number"==typeof e?document.createTextNode(e):(n=n||"svg"===e.nodeName)?document.createElementNS("http://www.w3.org/2000/svg",e.nodeName):document.createElement(e.nodeName),i=e.attributes;if(i){i.oncreate&&c.push((function(){i.oncreate(r)}));for(var o=0;o<e.children.length;o++)r.appendChild(t(e.children[o]=d(e.children[o]),n));for(var s in i)b(r,s,i[s],null,n)}return r}(i,o);e.insertBefore(s,n),null!=r&&S(e,n,r),n=s}else if(null==r.nodeName)n.nodeValue=i;else{!function(t,e,n,r){for(var i in m(e,n))n[i]!==("value"===i||"checked"===i?t[i]:e[i])&&b(t,i,n[i],e[i],r);var o=u?n.oncreate:n.onupdate;o&&c.push((function(){o(t,e)}))}(n,r.attributes,i.attributes,o=o||"svg"===i.nodeName);for(var a={},l={},h=[],f=r.children,p=i.children,g=0;g<f.length;g++){h[g]=n.childNodes[g],null!=(y=v(f[g]))&&(a[y]=[h[g],f[g]])}g=0;for(var _=0;_<p.length;){var y=v(f[g]),x=v(p[_]=d(p[_]));if(l[y])g++;else if(null==x||x!==v(f[g+1]))if(null==x||u)null==y&&(t(n,h[g],f[g],p[_],o),_++),g++;else{var w=a[x]||[];y===x?(t(n,w[0],w[1],p[_],o),g++):w[0]?t(n,n.insertBefore(w[0],h[g]),w[1],p[_],o):t(n,h[g],null,p[_],o),l[x]=p[_],_++}else null==y&&S(n,h[g],f[g]),g++}for(;g<f.length;)null==v(f[g])&&S(n,h[g],f[g]),g++;for(var g in a)l[g]||S(n,a[g][0],a[g][1])}return n}(r,s,a,a=t)),u=!1;c.length;)c.pop()()}function p(){i||(i=!0,setTimeout(f))}function m(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n}function g(t,e,n){var r={};return t.length?(r[t[0]]=t.length>1?g(t.slice(1),e,n[t[0]]):e,m(n,r)):e}function _(t,e){for(var n=0;n<t.length;)e=e[t[n++]];return e}function v(t){return t?t.key:null}function y(t){return t.currentTarget.events[t.type](t)}function b(t,e,n,r,i){if("key"===e);else if("style"===e)if("string"==typeof n)t.style.cssText=n;else for(var o in"string"==typeof r&&(r=t.style.cssText=""),m(r,n)){var s=null==n||null==n[o]?"":n[o];"-"===o[0]?t.style.setProperty(o,s):t.style[o]=s}else"o"===e[0]&&"n"===e[1]?(e=e.slice(2),t.events?r||(r=t.events[e]):t.events={},t.events[e]=n,n?r||t.addEventListener(e,y):t.removeEventListener(e,y)):e in t&&"list"!==e&&"type"!==e&&"draggable"!==e&&"spellcheck"!==e&&"translate"!==e&&!i?t[e]=null==n?"":n:null!=n&&!1!==n&&t.setAttribute(e,n),null!=n&&!1!==n||t.removeAttribute(e)}function S(t,e,n){function r(){t.removeChild(function t(e,n){var r=n.attributes;if(r){for(var i=0;i<n.children.length;i++)t(e.childNodes[i],n.children[i]);r.ondestroy&&r.ondestroy(e)}return e}(e,n))}var i=n.attributes&&n.attributes.onremove;i?i(e,r):r()}}var u=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}};var l=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)};var h=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var d=function(t){return u(t)||l(t)||h()};function f(t,e){for(var n=[],r=[],i=arguments.length;2<i--;)n.push(arguments[i]);for(;n.length;){var o=n.pop();if(o&&o.pop)for(i=o.length;i--;)n.push(o[i]);else null!=o&&!0!==o&&!1!==o&&r.push(o)}return"function"==typeof t?t(e||{},r):{nodeName:t,attributes:e||{},children:r,key:e&&e.key}}function p(t,e,n,r){function i(t){return"function"==typeof t?i(t(x,w)):null==t?"":t}function o(){g=!g;var t=i(n);for(r&&!g&&(v=function t(e,n,r,o,s){if(o===r);else if(null==r||r.nodeName!==o.nodeName){var a=f(o,s);e.insertBefore(a,n),null!=r&&m(e,n,r),n=a}else if(null==r.nodeName)n.nodeValue=o;else{p(n,r.attributes,o.attributes,s=s||"svg"===o.nodeName);for(var c={},u={},h=[],d=r.children,g=o.children,_=0;_<d.length;_++){h[_]=n.childNodes[_],null!=(y=l(d[_]))&&(c[y]=[h[_],d[_]])}_=0;for(var v=0;v<g.length;){var y=l(d[_]),b=l(g[v]=i(g[v]));if(u[y])_++;else if(null==b||b!==l(d[_+1]))if(null==b||S)null==y&&(t(n,h[_],d[_],g[v],s),v++),_++;else{var x=c[b]||[];y===b?(t(n,x[0],x[1],g[v],s),_++):x[0]?t(n,n.insertBefore(x[0],h[_]),x[1],g[v],s):t(n,h[_],null,g[v],s),u[b]=g[v],v++}else null==y&&m(n,h[_],d[_]),_++}for(;_<d.length;)null==l(d[_])&&m(n,h[_],d[_]),_++;for(var _ in c)u[_]||m(n,c[_][0],c[_][1])}return n}(r,v,y,y=t)),S=!1;b.length;)b.pop()()}function s(){g||(g=!0,setTimeout(o))}function a(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n}function c(t,e,n){var r={};return t.length?(r[t[0]]=1<t.length?c(t.slice(1),e,n[t[0]]):e,a(n,r)):e}function u(t,e){for(var n=0;n<t.length;)e=e[t[n++]];return e}function l(t){return t?t.key:null}function h(t){return t.currentTarget.events[t.type](t)}function d(t,e,n,r,i){if("key"===e);else if("style"!==e)"o"===e[0]&&"n"===e[1]?(e=e.slice(2),t.events?!r&&(r=t.events[e]):t.events={},t.events[e]=n,n?!r&&t.addEventListener(e,h):t.removeEventListener(e,h)):e in t&&"list"!==e&&"type"!==e&&"draggable"!==e&&"spellcheck"!==e&&"translate"!==e&&!i?t[e]=null==n?"":n:null!=n&&!1!==n&&t.setAttribute(e,n),(null==n||!1===n)&&t.removeAttribute(e);else if("string"==typeof n)t.style.cssText=n;else for(var o in"string"==typeof r&&(r=t.style.cssText=""),a(r,n)){var s=null==n||null==n[o]?"":n[o];"-"===o[0]?t.style.setProperty(o,s):t.style[o]=s}}function f(t,e){var n="string"==typeof t||"number"==typeof t?document.createTextNode(t):(e=e||"svg"===t.nodeName)?document.createElementNS("http://www.w3.org/2000/svg",t.nodeName):document.createElement(t.nodeName),r=t.attributes;if(r){r.oncreate&&b.push((function(){r.oncreate(n)}));for(var o=0;o<t.children.length;o++)n.appendChild(f(t.children[o]=i(t.children[o]),e));for(var s in r)d(n,s,r[s],null,e)}return n}function p(t,e,n,r){for(var i in a(e,n))n[i]!==("value"==i||"checked"===i?t[i]:e[i])&&d(t,i,n[i],e[i],r);var o=S?n.oncreate:n.onupdate;o&&b.push((function(){o(t,e)}))}function m(t,e,n){function r(){t.removeChild(function t(e,n){var r=n.attributes;if(r){for(var i=0;i<n.children.length;i++)t(e.childNodes[i],n.children[i]);r.ondestroy&&r.ondestroy(e)}return e}(e,n))}var i=n.attributes&&n.attributes.onremove;i?i(e,r):r()}var g,_=[].map,v=r&&r.children[0]||null,y=v&&function t(e){return{nodeName:e.nodeName.toLowerCase(),attributes:{},children:_.call(e.childNodes,(function(e){return 3===e.nodeType?e.nodeValue:t(e)}))}}(v),b=[],S=!0,x=a(t),w=function t(e,n,r){for(var i in r)"function"==typeof r[i]?function(t,i){r[t]=function(t){var o=i(t);return"function"==typeof o&&(o=o(u(e,x),r)),o&&o!==(n=u(e,x))&&!o.then&&s(x=c(e,a(n,o),x)),o}}(i,r[i]):t(e.concat(i),n[i]=a(n[i]),r[i]=a(r[i]));return r}([],x,a(e));return s(),w}var m=function(t,e){return"number"==typeof t?"".concat(t,"px"):!1===t?e:t},g={grow:function(t){return{flexGrow:t}},shrink:function(t){return{flexShrink:t}},basis:function(t){return{flexBasis:m(t,"auto")}},align:function(t){return{alignItems:t}},justify:function(t){return{justifyContent:t}},padding:function(t){return{margin:m(t,"0")}},margin:function(t){return{margin:m(t,"0")}}},_=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=t.class instanceof Array?t.class:[t.class],r=["osjs-gui"].concat(d(n));t.orientation&&r.push("osjs-gui-"+t.orientation);var i="string"==typeof t.style?{}:Object.assign({},t.style||{}),o=Object.keys(t).reduce((function(e,n){var r=g[n]?g[n](t[n]):void 0;return Object.assign({},e,r)}),i);return f("div",{oncreate:t.oncreate,ondestroy:t.ondestroy,class:r.filter((function(t){return!!t})).join(" "),style:o},e)},v=function(t,e){return f(_,Object.assign({orientation:"horizontal"},t,{class:["osjs-gui-box",t.class]}),e)},y=function(t,e){return f(_,Object.assign({},t,{class:["osjs-gui-box-container",t.class]}),e)},b=function(t,e){return f(_,Object.assign({},t,{class:["osjs-gui-box-styled",t.class]}),e)};function S(t,e){return t(e={exports:{}},e.exports),e.exports}var x=S((function(t){function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(n)}t.exports=e})),w=function(t){var e=t&&"object"===x(t)?t.src:t;return f("i",{"data-icon":t&&"object"===x(t)?t.name:void 0,class:"osjs-icon",style:{backgroundImage:"string"==typeof t?"url(".concat(e,")"):void 0}})};var T=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},N=function(t,e){return Object.keys(t).filter((function(t){return-1===e.indexOf(t)})).reduce((function(e,n){return Object.assign(T({},n,t[n]),e)}),{})},A=function(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:250,n=!1;return function(r,i){return t=clearTimeout(t),t=setTimeout((function(){return n=!1}),e),n?(r.preventDefault(),i(r)):(n=!0,!1)}},E=function(t,e,n,r,i){var o=e.oninput||function(){},s=e.onchange||function(){},a=e.onkeydown||function(){},c=i||function(t){return[t.target.value]},u=Object.assign({oninput:function(t){return o.apply(void 0,[t].concat(d(c(t))))},onchange:function(t){return s.apply(void 0,[t].concat(d(c(t))))},onkeydown:function(t){13===t.keyCode&&e.onenter&&e.onenter.apply(e,[t].concat(d(c(t)))),a(t)}},n,N(e,["choices","label","box","oninput","onchange"]));return f(_,Object.assign({},e.box||{},{class:"osjs-gui-field osjs-gui-"+t}),r(u))},O=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return E("button",t,{},(function(n){var r=[];return t.icon&&r.push(f(w,t.icon)),"string"==typeof t.label&&r.push(f("span",{class:"osjs-label"},t.label)),f("button",n,[].concat(r,d(e)))}))},C=function(t){return f("div",{id:"osjs-context-menu",className:"osjs-gui osjs-gui-menu",oncreate:t.oncreate,onupdate:t.onupdate,style:{display:!1===t.visible?"none":"block",top:t.position?t.position.top+"px":0,left:t.position?t.position.left+"px":0}},function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=function(t){var e=[];return"checkbox"===t.type||"boolean"==typeof t.checked?e.push(f("span",{class:"osjs-gui-menu-checkbox "+(t.checked?"active":"")})):t.icon&&e.push(f(w,t.icon)),e.push(f("span",{},t.label)),e},o=function(e,n){if("function"==typeof n.element)return n.element();var o=[f("span",{class:"separator"===n.type?"osjs-gui-menu-separator":"osjs-gui-menu-label "+(n.disabled?"osjs__disabled":"")},i(n))];return n.items&&o.push(t(e,n.items,r+1)),o};return f("ul",{class:""},n.map((function(t){return f("li",{class:"osjs-gui-menu-entry"},[f("div",{class:"osjs-gui-menu-container","data-has-image":!!t.icon||void 0,"data-has-children":!!t.items||void 0,onmouseover:t.items?e.onshow:void 0,ontouchend:t.items?e.onshow:void 0,onclick:function(n){t.items||(t.onclick&&t.onclick(t,n),e.onclick&&e.onclick(t,n,t))}},o(e,t))])})))}(t,t.menu))},L=function(t,e){return f(_,Object.assign({orientation:"vertical"},t,{class:["osjs-gui-toolbar",t.class]}),e)},I=function(t,e){return f(_,Object.assign({},t.box||{},{class:["osjs-gui-statusbar",t.class]}),e)},j=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=t.onclick,r=t.data;return f("div",{onclick:function(t){if("function"==typeof n){var e=t.target.parentNode,i=Array.prototype.indexOf.call(e.children,t.target);n(t,r||{},i)}}},f("span",{},e))},H=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return f(_,Object.assign({},t,{class:["osjs-gui-menubar",t.class]}),[].concat(d((t.items||[]).map((function(e){return f(j,{data:e.data,onclick:e.onclick||t.onclick},e.label)}))),d(e)))};function M(t,e,n,r){return e._$r=function(){return{}},function(i,o){return f(r||"x-",{key:i.key,id:i.id,class:i.class,oncreate:function(r){var s=p(t,e,(function(t,e){var i=n(t,e);return"function"==typeof i&&(i=i(r._$p,r._$c)),i}),r);r._$p=i,r._$c=o,r._$r=s._$r,r._$u=s.uninit,s.init&&s.init(i),i.oncreate&&i.oncreate(r)},onupdate:function(t){t._$p=i,t._$c=o,t._$r(),i.onupdate&&i.onupdate(t)},ondestroy:function(t){t._$u&&t._$u()},onremove:function(t,e){return i.onremove?void i.onremove(t,e):e()}})}}var k=function(t,e,n,r){var i=Array(Math.ceil(n.length/2)).fill(null).map((function(){return f("div",{class:"osjs-gui-panes-spacer",onmousedown:function(t){return function(t,e,n){var r=t.target,i=t.clientX,o=t.clientY,s=r.previousSibling,a=s.offsetWidth,c=s.offsetHeight,u=Array.from(r.parentNode.children).indexOf(s),l=.8*s.parentNode.offsetWidth,h=.8*s.parentNode.offsetHeight;if(!(0>u)){var d=function(t){var r=Math.min;t.preventDefault();var s="vertical"===n?a:c;if("vertical"===n){var d=t.clientX-i;s=r(l,s+d)}else{var f=t.clientY-o;s=r(h,s+f)}e.setSize({index:u,size:s})};t.preventDefault(),document.addEventListener("mousemove",d),document.addEventListener("mouseup",(function t(e){e.preventDefault(),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",t)}))}}(t,e,r)}})}));return n.map((function(e,n){var r=t.sizes[n]?t.sizes[n]+"px":void 0;return f("div",{class:"osjs-gui-panes-pane",style:{flex:r?"0 0 ".concat(r):r}},e)})).map((function(t,e){return[t,i[e]]})).reduce((function(t,e){return t.concat(e)})).filter((function(t){return void 0!==t}))},D=(M({sizes:[]},{init:function(t){return{sizes:t.sizes||[150]}},setSize:function(t){var e=t.index,n=t.size;return function(t){var r=[].concat(t.sizes);return r[e]=n,{sizes:r}}}},(function(t,e){return function(n,r){var i=n.orientation||"vertical";return f(_,{orientation:i,class:"osjs-gui-panes-inner"},k(t,e,r,i))}}),"div"),A()),R=function(t){return f(_,Object.assign({class:"osjs-gui-list-view"},t.box||{}),function(t){var e=function(e){return function(n,r){var i=n.columns[e]||{},o=t.selectedIndex===r,s=i.icon?f(w,i.icon):null,a=[f("span",{},["object"===x(i)?i.label:i])];return s&&a.unshift(s),f("div",{key:n.key,"data-has-icon":!!i.icon||void 0,class:"osjs-gui-list-view-cell"+(o?" osjs__active":""),ontouchstart:function(e){return D(e,(function(){return t.onactivate({data:n.data,index:r,ev:e})}))},ondblclick:function(e){return t.onactivate({data:n.data,index:r,ev:e})},onclick:function(e){return t.onselect({data:n.data,index:r,ev:e})},oncontextmenu:function(e){return t.oncontextmenu({data:n.data,index:r,ev:e})},oncreate:function(e){return t.oncreate({data:n.data,index:r,el:e})}},a)}},n=function(n,r){return f("div",{class:"osjs-gui-list-view-pane",style:r.style||{}},[f("div",{class:"osjs-gui-list-view-header",style:{display:t.hideColumns?"none":void 0}},f("span",{},"object"===x(r)?r.label:r)),f("div",{class:"rows","data-zebra":t.zebra+""},t.rows.map(e(n)))])};return f("div",{class:"osjs-gui-list-view-wrapper",oncreate:function(e){return e.scrollTop=t.scrollTop},onupdate:function(e){0>t.selectedIndex&&(e.scrollTop=t.scrollTop)}},t.columns.map((function(t,e){return n(e,t)})))}(N(t,["box"])))},q=function(t,e){var n=Object.assign({zebra:!0,columns:[],rows:[],onselect:function(t){var n=t.data,r=t.index,i=t.ev;e.select({data:n,index:r,ev:i}),e.setSelectedIndex(r)},onactivate:function(t){var n=t.data,r=t.index,i=t.ev;e.activate({data:n,index:r,ev:i}),e.setSelectedIndex(-1)},oncontextmenu:function(t){var n=t.data,r=t.index,i=t.ev;e.select({data:n,index:r,ev:i}),e.contextmenu({data:n,index:r,ev:i}),e.setSelectedIndex(r)},oncreate:function(t){e.created(t)}},t);return function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return R(Object.assign(n,t))}},F=function(t){return Object.assign({selectedIndex:-1,scrollTop:0},t)},B=function(t){return Object.assign({select:function(){return function(){return{}}},activate:function(){return function(){return{}}},contextmenu:function(){return function(){return{}}},created:function(){return function(){return{}}},setRows:function(t){return{rows:t}},setColumns:function(t){return{columns:t}},setScrollTop:function(t){return function(){return{scrollTop:t}}},setSelectedIndex:function(t){return function(){return{selectedIndex:t}}}},t||{})},P=(A(),function(t,e,n){var r=t.labels,i=t.onchange,o=t.oncontextmenu;return(r||[]).map((function(t,r){return f("div",{class:e.selectedIndex===r?"osjs__active":"",oncontextmenu:function(e){(o||function(){})(e,r,t)},onclick:function(e){n.setSelectedIndex(r),(i||function(){})(e,r,t)}},f("span",{},t))}))}),X=function(t,e){return e.map((function(e,n){return f("div",{class:t.selectedIndex===n?"osjs__active":""},e)}))},J=(M({selectedIndex:0},{init:function(t){return{selectedIndex:t.selectedIndex||0}},setSelectedIndex:function(t){return function(){return{selectedIndex:t}}}},(function(t,e){return function(n,r){return f("div",{class:"osjs-gui-tabs-wrapper"},[f("div",{class:"osjs-gui-tabs-header"},P(n,t,e)),f("div",{class:"osjs-gui-tabs-panes"},X(t,r))])}}),"div"),function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return E("text-field",t,{autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",type:"text"},(function(t){return f("input",t)}))}),U=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return E("textarea-field",t,{rows:4},(function(t){return f("textarea",t,e)}))},$=(M({active:!0},{init:function(t){return{ative:!1!==t.active}},ontoggle:function(t){var e=t.ev,n=t.active;return(t.ontoggle||function(){})(e,n),{active:n}}},(function(t,e){return function(n,r){return f(_,Object.assign({},n.box||{},{class:["osjs-gui-expander-wrapper"]}),[f("div",{class:"osjs-gui-expander-header",onclick:function(r){return e.ontoggle({ev:r,active:!t.active,ontoggle:n.ontoggle})}},[f("div",{class:"osjs-gui-expander-header-icon","data-active":t.active+""}),f("div",{class:"osjs-gui-expander-header-label"},n.label)]),f("div",{class:"osjs-gui-expander-content",style:{display:!1===t.active?"none":void 0}},r)])}}),"div"),S((function(t){var e=function(t){function e(t,e,n,i){var o=e&&e.prototype instanceof r?e:r,s=Object.create(o.prototype),a=new d(i||[]);return s._invoke=c(t,n,a),s}function n(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function r(){}function i(){}function o(){}function s(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function a(t){function e(r,i,o,s){var a=n(t[r],t,i);if("throw"!==a.type){var c=a.arg,u=c.value;return u&&"object"==typeof u&&_.call(u,"__await")?Promise.resolve(u.__await).then((function(t){e("next",t,o,s)}),(function(t){e("throw",t,o,s)})):Promise.resolve(u).then((function(t){c.value=t,o(c)}),(function(t){return e("throw",t,o,s)}))}s(a.arg)}var r;this._invoke=function(t,n){function i(){return new Promise((function(r,i){e(t,n,r,i)}))}return r=r?r.then(i,i):i()}}function c(t,e,r){var i="suspendedStart";return function(o,s){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw s;return p()}for(r.method=o,r.arg=s;;){var a=r.delegate;if(a){var c=u(a,r);if(c){if(c===x)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var l=n(t,e,r);if("normal"===l.type){if(i=r.done?"completed":"suspendedYield",l.arg===x)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i="completed",r.method="throw",r.arg=l.arg)}}}function u(t,e){var r=t.iterator[e.method];if(r===m){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=m,u(t,e),"throw"===e.method))return x;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return x}var i=n(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,x;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=m),e.delegate=null,x):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,x)}function l(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function h(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function d(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(!0)}function f(t){if(t){var e=t[y];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(_.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=m,e.done=!0,e};return r.next=r}}return{next:p}}function p(){return{value:m,done:!0}}var m,g=Object.prototype,_=g.hasOwnProperty,v="function"==typeof Symbol?Symbol:{},y=v.iterator||"@@iterator",b=v.asyncIterator||"@@asyncIterator",S=v.toStringTag||"@@toStringTag";t.wrap=e;var x={},w={};w[y]=function(){return this};var T=Object.getPrototypeOf,N=T&&T(T(f([])));N&&N!==g&&_.call(N,y)&&(w=N);var A=o.prototype=r.prototype=Object.create(w);return i.prototype=A.constructor=o,o.constructor=i,o[S]=i.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===i||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,o):(t.__proto__=o,!(S in t)&&(t[S]="GeneratorFunction")),t.prototype=Object.create(A),t},t.awrap=function(t){return{__await:t}},s(a.prototype),a.prototype[b]=function(){return this},t.AsyncIterator=a,t.async=function(n,r,i,o){var s=new a(e(n,r,i,o));return t.isGeneratorFunction(r)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},s(A),A[S]="Generator",A[y]=function(){return this},A.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=f,d.prototype={constructor:d,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(h),!t)for(var e in this)"t"===e.charAt(0)&&_.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=m)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function e(e,r){return o.type="throw",o.arg=t,n.next=e,r&&(n.method="next",n.arg=m),!!r}if(this.done)throw t;for(var n=this,r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var s=_.call(i,"catchLoc"),a=_.call(i,"finallyLoc");if(s&&a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(t,e){for(var n,r=this.tryEntries.length-1;0<=r;--r)if((n=this.tryEntries[r]).tryLoc<=this.prev&&_.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,x):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),x},finish:function(t){for(var e,n=this.tryEntries.length-1;0<=n;--n)if((e=this.tryEntries[n]).finallyLoc===t)return this.complete(e.completion,e.afterLoc),h(e),x},catch:function(t){for(var e,n=this.tryEntries.length-1;0<=n;--n)if((e=this.tryEntries[n]).tryLoc===t){var r=e.completion;if("throw"===r.type){var i=r.arg;h(e)}return i}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:f(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=m),x}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}})));function G(t,e,n,r,i,o,s){try{var a=t[o](s),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}var z=function(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){function o(t){G(a,r,i,o,s,"next",t)}function s(t){G(a,r,i,o,s,"throw",t)}var a=t.apply(e,n);o(void 0)}))}};var W=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function Q(t,e){for(var n,r=0;r<e.length;r++)(n=e[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}var V=function(t,e,n){return e&&Q(t.prototype,e),n&&Q(t,n),t},Y=function(t){return t(),setTimeout(t,100)},K=function(){function t(e){W(this,t),this.core=e,this.callback=function(){},this.actions=null,this.$element=document.createElement("div")}return V(t,[{key:"destroy",value:function(){this.callback=null,this.actions=null}},{key:"init",value:function(){var t,e=this;this.$element.className="osjs-system-context-menu",this.core.$root.appendChild(this.$element);var n=!1;this.actions=p({visible:!1,menu:[],position:{top:0,left:0}},{clamp:function(n){return function(r){if(n=n||document.querySelector("#osjs-context-menu"),clearTimeout(t),n){var i=function(t,e,n){var r={},i=n.top+e.offsetHeight,o=n.left+e.offsetWidth,s=t.offsetHeight-n.top,a=t.offsetWidth-n.left,c=o>t.offsetWidth,u=i>t.offsetHeight;return u&&t.offsetHeight>e.offsetHeight&&(r.top=t.offsetHeight-e.offsetHeight-s),c&&(r.left=t.offsetWidth-e.offsetWidth-a),u||c?r:null}(e.core.$root,n,r.position);if(i)return{position:i}}return{}}},onshow:function(n){return function(){t=Y((function(){return function(t,e){var n=e.target.querySelector("ul");n&&(n.classList.contains("osjs-gui-menu-container")&&(n=n.parentNode.parentNode),n&&n.offsetParent)&&(n.classList.remove("clamp-right"),n.getBoundingClientRect().right>t.offsetWidth&&n.classList.add("clamp-right"))}(e.core.$root,n)}))}},show:function(t){return function(r,i){var o=t.menu,s=t.position;if(t.toggle&&n)return i.hide();if(s instanceof Event)s={left:s.clientX,top:s.clientY};else if(s instanceof Element){var a=s.getBoundingClientRect();s={left:a.left,top:a.top+a.height}}return e.callback=function(e,n,r){t.callback&&t.callback(e,n),!1!==r.closeable&&i.hide()},n=!0,e.onclose=t.onclose,Y((function(){return i.clamp()})),{visible:!0,menu:o||[],position:s||{top:0,left:0}}}},hide:function(){return function(){return n&&setTimeout((function(){return n=!1}),0),e.onclose&&e.onclose(),e.onclose=null,e.callback=null,{visible:!1}}}},function(t){return function(e,n){return f(C,{position:e.position,visible:e.visible,menu:e.menu,onclick:t,onshow:n.onshow})}}((function(){!e.core.destroyed&&e.callback&&e.callback.apply(e,arguments)})),this.$element)}},{key:"show",value:function(){var t;return this.actions?(t=this.actions).show.apply(t,arguments):null}},{key:"hide",value:function(){var t;return this.actions?(t=this.actions).hide.apply(t,arguments):null}}]),t}(),Z=function(t){var e=t.target,n="TEXTAREA"===e.tagName;return n||"INPUT"!==e.tagName||(n=-1!==["text","password","number","email"].indexOf(e.type)),n},tt=(function(){function t(e){W(this,t),this.core=e,this.contextmenu=new K(e)}V(t,[{key:"destroy",value:function(){var t=document.getElementById("osjs-context-menu");t&&t.remove(),this.contextmenu.destroy()}},{key:"init",value:function(){var t=z($.mark((function t(){var e,n=this;return $.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e={show:function(){var t;return(t=n.contextmenu).show.apply(t,arguments)},hide:function(){var t;return(t=n.contextmenu).hide.apply(t,arguments)}},this.core.instance("osjs/contextmenu",(function(){return arguments.length?e.show.apply(e,arguments):e})),this.core.$root.addEventListener("contextmenu",(function(t){Z(t)||(t.stopPropagation(),t.preventDefault())}));case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"start",value:function(){var t=this,e=function(e){!document.getElementById("osjs-context-menu").contains(e.target)&&t.contextmenu&&t.contextmenu.hide()};this.core.$root.addEventListener("click",e,!0),this.core.once("destroy",(function(){t.core.$root.removeEventListener("click",e,!0)})),this.contextmenu.init()}}])}(),n(1)),et=n.n(tt),nt={chat:"Available",busy:"Busy",away:"Away",offline:"Offline",invisible:"Invisible"},rt=function(t){var e=document.createElement("html");return e.innerHTML=t,e.getElementsByTagName("body")[0]},it=function(t){return nt[t]||t},ot=function(t){return t.split("/")[0]},st=function(t){var e=t.getElementsByTagName("body");return e.length?Array.from(e).map((function(t){return s.Strophe.getText(t)})).join("\n"):""},at=function(t){var e=t.self,n=t.from,r=t.body,i=t.date;return a("div",{class:["chat-message",e?"chat-message-self":"chat-message-other"].join(" ")},[a("div",{class:"chat-message__header"},[a("div",{class:"chat-message__header--date"},"".concat(i," - ")),a("div",{class:"chat-message__header--username"},"".concat(ot(n),":"))]),a("div",{class:"chat-message__body"},r)])},ct=function(t,e,n,r,i){var o=t.make("osjs/locale").format,u=e.createWindow({id:i.id,title:i.title,icon:e.resource(e.metadata.icon),parent:n,attributes:{classNames:["StropheJSChatWindow"]},dimension:{width:400,height:300}}),l=function(t,e){return t.messages.map((function(t){var e=t.date,n=t.msg;return a(at,{date:o(e,"longTime"),self:ot(n.getAttribute("from"))!==ot(i.user),to:n.getAttribute("to"),from:n.getAttribute("from"),type:n.getAttribute("type"),body:st(n)})}))},h=function(t){var e=t.messages.length>0?t.messages[t.messages.length-1]:null;return e?"Last message: ".concat(o(e.date)):"Conversation started..."},d=function(t,e){return a(v,{},[a(b,{grow:1,shrink:1,class:"chat-messages",orientation:"horizontal"},et()(l(t))),a(y,{},[a(U,{box:{grow:1},rows:2,placeholder:"Enter message and use shift+enter to send...",onenter:function(t){t.shiftKey&&e.send()}}),a(O,{onclick:function(){return e.send()}},"Send")]),a(I,{},[t.typing?"".concat(i.title," is typing..."):h(t)])])};return u.render((function(t){var e,n=c({typing:!1,messages:[]},{send:function(){return function(e,n){var r=t.querySelector("textarea"),o=r.value.trim();if(o.length){var a=function(t,e,n){return Object(s.$msg)({to:e,from:t,type:"chat"}).cnode(s.Strophe.xmlElement("body",n)).up().c("active",{xmlns:"http://jabber.org/protocol/chatstates"}).tree()}(i.self,i.user,o);n.sendMessage(a),n.addMessage({date:new Date,msg:a}),setTimeout((function(){return r.value=""}),1)}}},setTypeStatus:function(t){return function(){return{typing:t}}},sendMessage:function(t){return function(){return r.emit("send-message",t)}},addMessage:function(t){return function(e){return{messages:[].concat(et()(e.messages),[t])}}}},d,t);u.on("strophejs/message",(function(e){n.addMessage({date:new Date,msg:e});var r=t.querySelector(".chat-messages");r&&setTimeout((function(){r.scrollTop=r.scrollHeight}),1)})),u.on("strophejs/started-typing",(function(){clearTimeout(e),e=setTimeout((function(){n.setTypeStatus(!1)}),1e3),n.setTypeStatus(!0)})),u.on("strophejs/stopped-typing",(function(){return n.setTypeStatus(!1)}))})),u},ut=function(t,e,n){return{type:"checkbox",label:it(n),disabled:!t.connected,checked:t.availability===n,onclick:function(){return e.menuSetStatus(n)}}},lt=function(t,e){return[{label:"Connection Options",onclick:function(){return e.menuOptions()}},{label:"Connect",disabled:t.connected,onclick:function(){return e.menuConnect()}},{label:"Disconnect",disabled:!t.connected,onclick:function(){return e.menuDisconnect()}},{label:"Quit",onclick:function(){return e.menuQuit()}}]},ht=function(t,e,n){return[ut(t,e,"chat"),ut(t,e,"busy"),ut(t,e,"away"),ut(t,e,"offline"),ut(t,e,"invisible")]},dt=function(t,e,n){var r=e.createWindow({id:"StropheJSMainWindow",icon:e.resource(e.metadata.icon),title:e.metadata.title.en_EN,dimension:{width:400,height:400},attributes:{closeable:!1,visibility:"restricted"}}),i=function(t,e){var n,r=q(t.contacts,e.contacts);return a(v,{},[a(H,{},[a(j,{onclick:function(t){return e.menuFile(t)}},"File"),a(j,{onclick:function(t){return e.menuStatus(t)}},"Status")]),a(r,{box:{shrink:1,grow:1}}),a(I,{},["".concat((n=t.status,Object.keys(s.Strophe.Status).find((function(t){return s.Strophe.Status[t]===n}))||"Disconnected")," - ").concat(it(t.availability))])])};return r.render((function(r){var o=c({connected:!1,availability:"chat",status:-1,contacts:F({rows:[],columns:[{label:"Name"},{label:"Status"}]})},{menuOptions:function(){return function(){return n.emit("open-connection-window")}},menuConnect:function(){return function(){return n.emit("connect")}},menuDisconnect:function(){return function(){return n.emit("disconnect")}},menuQuit:function(){return function(){return e.destroy()}},menuFile:function(e){return function(n,r){t.make("osjs/contextmenu").show({position:e.target,menu:lt(n,r)})}},menuStatus:function(e){return function(n,r){t.make("osjs/contextmenu").show({position:e.target,menu:ht(n,r)})}},menuSetStatus:function(t){return function(e,r){n.emit("set-status",t)}},getContacts:function(){return function(t){return t.contacts.rows}},setAvailability:function(t){return function(e){return{availability:t}}},getStatus:function(){return function(t){return t.status}},setStatus:function(t){return function(e){return{connected:t===s.Strophe.Status.CONNECTED,status:t}}},contacts:B({select:function(t){t.data},activate:function(t){var e=t.data;return n.emit("open-chat-window",e.user)}})},i,r);n.on("presence",(function(t){var e=o.getContacts();try{var n=function(t){var e=t.getAttribute("from");if(t.querySelector("error"))throw new Error(st(t));var n=t.querySelector("show"),r=t.querySelector("photo"),i=n?s.Strophe.getText(n):null,o=r?s.Strophe.getText(r):null;return{user:ot(e),photo:o,status:i}}(t),r=e.findIndex((function(t){return t.data.user===n.user})),i={columns:[n.user,it(n.status||"offline")],data:n};-1===r?e.push(i):e[r]=i,o.contacts.setRows(e)}catch(t){console.warn(t)}})),n.on("status-change",(function(t){return o.setStatus(t)})),n.on("availability-change",(function(t){return o.setAvailability(t)})),n.on("disconnected",(function(){return o.setStatus(-1)}))})),r},ft=function(t,e){var n,r,i=t.make("osjs/event-emitter","Strophe.js"),o=dt(t,e,i),u=t.make("osjs/tray").create({title:"Strophe.js",icon:e.resource(e.metadata.icon)},(function(){o.raise(),o.focus()})),l=function(){n&&n.disconnect(),n=null,i.emit("disconnected")},h=function(t){var n="StropheJSChatWindow_"+ot(t);return e.windows.find((function(t){return t.id===n}))},d=function(r){var s=h(r);if(!s){var a=ot(r);s=ct(t,e,o,i,{id:"StropheJSChatWindow_"+a,self:n.jid,title:a,user:r})}return s};i.on("open-connection-window",(function(){return function(t,e,n,r){var i=e.createWindow({parent:n,icon:e.resource(e.metadata.icon),title:"XMPP Connection Options",id:"StropheJSConnectionWindow",dimension:{width:400,height:400},attributes:{sessionable:!1}}),o=function(t,e){return a(v,{},[a(v,{grow:1},[a(y,{orientation:"horizontal"},[a("div",{},"Host:"),a(J,{value:t.host,oninput:function(t,n){return e.setHost(n)}})]),a(y,{orientation:"horizontal"},[a("div",{},"Username:"),a(J,{value:t.username,oninput:function(t,n){return e.setUsername(n)}})]),a(y,{orientation:"horizontal"},[a("div",{},"Password:"),a(J,{type:"password",value:t.password,oninput:function(t,n){return e.setPassword(n)}})])]),a(L,{justify:"flex-end"},[a(O,{onclick:function(){return e.connect()}},"Connect"),a(O,{onclick:function(){return e.close()}},"Close")])])};return i.render((function(t){return c(Object.assign({},e.settings),{setHost:function(t){return function(e){return{host:t}}},setUsername:function(t){return function(e){return{username:t}}},setPassword:function(t){return function(e){return{password:t}}},connect:function(){return function(t){r.emit("set-connection",t,!0),i.destroy()}},close:function(){return function(){i.destroy()}}},o,t)})),i.focus(),i}(0,e,o,i)})),i.on("open-chat-window",(function(t){return d(t).focus()})),i.on("send-message",(function(t){return n.send(t)})),i.on("receive-message",(function(t){var e=t.getAttribute("from"),n=t.getElementsByTagName("cha:composing").length>0,r=t.getElementsByTagName("cha:paused").length>0,i=t.getElementsByTagName("body").length>0;if(n||r){var o=h(e);o&&o.emit(n?"strophejs/started-typing":"strophejs/stopped-typing")}i&&d(e).emit("strophejs/message",t)})),i.on("set-status",(function(t,e){var r=Object(s.$pres)({from:n.jid});r.c("show",t),e&&r.c("status",e),n.send(r.tree()),i.emit("availability-change",t)})),i.on("set-connection",(function(t,n){Object.assign(e.settings,t),e.saveSettings(),n&&i.emit("connect")})),i.on("connected",(function(){return i.emit("set-status","chat")})),i.on("disconnect",l),i.on("connect",(function(){l(),n=function(t,e,n){var r=e.settings,i=r.host,o=r.username,a=r.password;try{var c=new s.Strophe.Connection(i);c.rawInput=function(t){return console.debug("input",rt(t))},c.rawOutput=function(t){return console.debug("output",rt(t))};var u=function(t){n.emit("status-change",t),t===s.Strophe.Status.CONNECTED&&n.emit("connected")};try{c.restore(null,u)}catch(t){console.warn(t),c.connect(o,a,u)}return c.addHandler((function(t){return n.emit("receive-message",t)}),null,"message",null,null,null),c.addHandler((function(t){return n.emit("presence",t)}),null,"presence",null,null,null),c.addHandler((function(){return!0}),"jabber:iq:roster","iq","set"),c}catch(t){console.error(t)}return null}(0,e,i)})),e.on("destroy",l),e.on("destroy",(function(){return i.off()})),e.on("destroy",(function(){return u.destroy()})),o.on("destroy",(function(){return e.destroy()})),r=e.settings,["host","username","password"].every((function(t){return!!r[t]}))?i.emit("connect"):i.emit("open-connection-window")},pt=function(t,e,n,r){var i=t.make("osjs/application",{args:e,options:Object.assign({settings:{host:"http://localhost:5280/http-bind",username:"username@gmail.com",password:""}},n),metadata:r});return ft(t,i),i};i.a.register(o.a,pt)}]);
//# sourceMappingURL=main.js.map